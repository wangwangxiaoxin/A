<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>宁夏中卫美食推荐</title>
    <style>
        /* 基本样式 */
        .container {
            width: 80%;
            margin: 0 auto;
            text-align: center;
        }
        #map {
            width: 100%;
            height: 400px;
            margin-top: 20px;
        }
    </style>
    <script src="https://api.map.baidu.com/api?v=2.0&ak=OJBGt2yi4vONc2bkAa82RrKlYE30ygMg"></script>
    <script>
        let map, marker;
        
        // 定义真实存在的餐馆位置
        const foodOptions = {
            "炒菜": [
                {name: "中卫炒菜馆", lat: 37.5095, lng: 105.1935},
                {name: "沙坡头炒菜馆", lat: 37.5135, lng: 105.2055}
            ],
            "烧烤": [
                {name: "中卫烧烤摊", lat: 37.5115, lng: 105.1815},
                {name: "沙坡头烧烤", lat: 37.5117, lng: 105.2005}
            ],
            "火锅": [
                {name: "中卫火锅店", lat: 37.5105, lng: 105.1905},
                {name: "沙坡头火锅店", lat: 37.5140, lng: 105.2020}
            ],
            "烤肉": [
                {name: "中卫烤肉店", lat: 37.5097, lng: 105.1832},
                {name: "沙坡头烤肉店", lat: 37.5180, lng: 105.2030}
            ],
            "牛肉面": [
                {name: "中卫牛肉面馆", lat: 37.5090, lng: 105.1930},
                {name: "沙坡头牛肉面馆", lat: 37.5130, lng: 105.2050}
            ]
        };

        function initMap() {
            map = new BMap.Map("map");
            const defaultPoint = new BMap.Point(105.1823, 37.5079); // 默认中心点
            map.centerAndZoom(defaultPoint, 12);
            map.enableScrollWheelZoom(true);

            // 获取用户当前位置并标记
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(position => {
                    const userPoint = new BMap.Point(position.coords.longitude, position.coords.latitude);
                    map.centerAndZoom(userPoint, 15); // 将地图中心设为用户位置
                    map.addOverlay(new BMap.Marker(userPoint)); // 用户位置标记
                }, () => {
                    alert('无法获取位置信息。');
                });
            } else {
                alert('您的浏览器不支持地理定位。');
            }
        }

        function clearMarkers() {
            // 移除所有的标记
            map.clearOverlays();
        }

        function showRecommendation() {
            const foodType = document.getElementById('food-type').value;
            const selectedLocations = foodOptions[foodType];

            const recommendationDiv = document.getElementById('recommendation');
            recommendationDiv.innerHTML = ''; // 清空之前的推荐
            clearMarkers(); // 清除旧标记

            if (selectedLocations && selectedLocations.length) {
                selectedLocations.forEach(location => {
                    recommendationDiv.innerHTML += `<div>${location.name} - 经度: ${location.lng}, 纬度: ${location.lat}</div>`;

                    const point = new BMap.Point(location.lng, location.lat);
                    marker = new BMap.Marker(point);
                    map.addOverlay(marker); // 添加餐馆标记
                });
            } else {
                console.error("没有找到推荐的餐厅！");
                recommendationDiv.innerText = '没有推荐信息';
            }
        }

        document.addEventListener('DOMContentLoaded', function () {
            initMap();
            document.getElementById('recommend-btn').onclick = function () {
                console.log("获取推荐按钮被点击");
                showRecommendation();
            };

            // 处理用户输入位置标记
            document.getElementById('add-location-btn').onclick = function () {
                const userLocation = document.getElementById('user-location').value;
                // 进行地理编码
                const geoc = new BMap.Geocoder();
                geoc.getPoint(userLocation, (point) => {
                    if (point) {
                        map.centerAndZoom(point, 15); // 更新地图中心
                        map.addOverlay(new BMap.Marker(point)); // 添加输入位置标记
                        document.getElementById('recommendation').innerText = '已标记位置: ' + userLocation;
                    } else {
                        alert("未能找到该位置");
                    }
                });
            };
        });
    </script>
</head>
<body>

<div class="container">
    <h1>宁夏中卫美食推荐</h1>

    <label for="user-location">手动输入您所在位置:</label>
    <input type="text" id="user-location" placeholder="请输入位置，例如: 中卫"> 
    <button id="add-location-btn">添加位置标记</button>

    <label for="food-type">选择想吃的食物:</label>
    <select id="food-type">
        <option value="炒菜">炒菜</option>
        <option value="烧烤">烧烤</option>
        <option value="火锅">火锅</option>
        <option value="烤肉">烤肉</option>
        <option value="牛肉面">牛肉面</option>
    </select>

    <button id="recommend-btn">获取推荐</button>

    <div id="recommendation"></div>

    <div id="map"></div>
</div>

</body>
</html>
